<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trox – الكبسولة الخالدة 🚀</title>
<style>
:root {
  --accent: #00ccff;
  --bg1: #000010;
  --bg2: #0b1020;
}
body {
  margin: 0;
  font-family: "Cairo", sans-serif;
  background: radial-gradient(ellipse at center,var(--bg1) 0%,var(--bg2) 100%);
  color: #fff;
  overflow-x: hidden;
}
.wrap{
  display:flex; flex-direction:column; align-items:center; padding:20px;
}
h1{color:var(--accent);}
input, textarea, select{
  width:100%; padding:10px; margin-top:6px; border-radius:8px; border:none; background:rgba(255,255,255,0.05); color:#fff;
}
button{
  padding:10px 20px; border-radius:50px; border:none; background:var(--accent); color:#000; font-weight:bold; cursor:pointer; margin-top:10px;
  transition:0.3s;
}
button:hover{background:#00aadd;}
.capsules{display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:12px; margin-top:20px;}
.capsule{background:rgba(255,255,255,0.02); padding:12px; border-radius:12px; backdrop-filter:blur(6px);}
.capsule h4{color:var(--accent); margin:0 0 6px;}
.capsule p{margin:4px 0 0; white-space:pre-wrap;}
</style>
<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCR8AiukqMEGOFDsjhv7tsFFFLDM5gWpu4",
  authDomain: "trox-capsules.firebaseapp.com",
  projectId: "trox-capsules",
  storageBucket: "trox-capsules.appspot.com",
  messagingSenderId: "104606988275",
  appId: "1:104606988275:web:24d2a719dd863357660486",
  measurementId: "G-MEKWLRWGDS"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.addEventListener('DOMContentLoaded', ()=>{
  const container = document.getElementById('capsulesContainer');
  const formBtn = document.getElementById('saveBtn');
  const usernameInput = document.getElementById('username');
  const titleInput = document.getElementById('title');
  const messageInput = document.getElementById('message');

  // Save capsule
  formBtn.addEventListener('click', async ()=>{
    const username = usernameInput.value.trim() || "مجهول";
    const title = titleInput.value.trim() || "كبسولة بدون عنوان";
    const message = messageInput.value.trim();
    if(!message){ alert("اكتب رسالة قبل الحفظ"); return; }
    await addDoc(collection(db,'capsules'), {username, title, message, timestamp: new Date()});
    usernameInput.value=''; titleInput.value=''; messageInput.value='';
    loadCapsules();
  });

  // Load capsules
  async function loadCapsules(){
    container.innerHTML='';
    const q = query(collection(db,'capsules'), orderBy('timestamp','desc'));
    const snapshot = await getDocs(q);
    if(snapshot.empty){ container.innerHTML='<p>لا توجد كبسولات حتى الآن.</p>'; return; }
    snapshot.forEach(doc=>{
      const data = doc.data();
      const div = document.createElement('div');
      div.className='capsule';
      div.innerHTML=`<h4>${data.title}</h4>
                     <small>المرسل: ${data.username}</small>
                     <p>${data.message}</p>`;
      container.appendChild(div);
    });
  }

  loadCapsules();
});
</script>
</head>
<body>
<div class="wrap">
  <h1>⚡ Trox – الكبسولة الخالدة ⚡</h1>
  <p>اكتب رسالة، احفظها كبسولة رقمية، وشارك لحظة خالدة مع العالم.</p>
  <section id="form">
    <input id="username" placeholder="اسمك (اختياري)">
    <input id="title" placeholder="عنوان للكبسولة">
    <textarea id="message" placeholder="اكتب رسالتك هنا..."></textarea>
    <button id="saveBtn">احفظ الكبسولة 🚀</button>
  </section>
  <section class="capsules" id="capsulesContainer"></section>
</div>
</body>
</html>
