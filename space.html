<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
  let scene, camera, renderer;
  let capsules = [];
  let particles = [];

  function init() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.z = 30;

    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const ambient = new THREE.AmbientLight(0x00b4d8, 1.3);
    const pointLight = new THREE.PointLight(0xffffff, 1.2);
    pointLight.position.set(10, 20, 20);
    scene.add(ambient, pointLight);

    const geometry = new THREE.CylinderGeometry(5, 5, 2, 6);
    const material = new THREE.MeshStandardMaterial({
      color: 0x00eaff,
      metalness: 0.8,
      roughness: 0.2,
      emissive: 0x0096c7,
      emissiveIntensity: 0.5
    });

    for (let i = 0; i < 25; i++) {
      const capsule = new THREE.Mesh(geometry, material.clone());
      capsule.position.set(
        (Math.random() - 0.5) * 120,
        (Math.random() - 0.5) * 120,
        (Math.random() - 0.5) * 120
      );
      capsule.rotation.x = Math.random() * Math.PI;
      capsule.rotation.y = Math.random() * Math.PI;
      capsule.userData = {
        message: "ðŸ’  ÙƒØ¨Ø³ÙˆÙ„Ø© Ø±Ù‚Ù… " + (i + 1),
        exploded: false
      };
      scene.add(capsule);
      capsules.push(capsule);
    }

    animate();

    window.addEventListener('resize', onWindowResize);
    window.addEventListener('click', onDocumentClick);
  }

  function animate() {
    requestAnimationFrame(animate);
    capsules.forEach(c => {
      c.rotation.x += 0.002;
      c.rotation.y += 0.003;
    });

    // Ø­Ø±ÙƒØ© Ø§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ÙØ¬Ø§Ø±
    particles.forEach(p => {
      p.position.add(p.userData.velocity);
      p.material.opacity -= 0.01;
      if (p.material.opacity <= 0) {
        scene.remove(p);
      }
    });

    renderer.render(scene, camera);
  }

  function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  }

  function onDocumentClick(event) {
    const mouse = new THREE.Vector2(
      (event.clientX / window.innerWidth) * 2 - 1,
      -(event.clientY / window.innerHeight) * 2 + 1
    );
    const raycaster = new THREE.Raycaster();
    raycaster.setFromCamera(mouse, camera);

    const intersects = raycaster.intersectObjects(capsules);
    if (intersects.length > 0) {
      const obj = intersects[0].object;
      if (!obj.userData.exploded) {
        obj.userData.exploded = true;
        triggerExplosion(obj);
        showMessage(obj.userData.message);
      }
    }
  }

  function triggerExplosion(obj) {
    const center = obj.position.clone();
    const material = new THREE.MeshBasicMaterial({ color: 0x00eaff, transparent: true });

    for (let i = 0; i < 30; i++) {
      const particle = new THREE.Mesh(new THREE.SphereGeometry(0.2, 8, 8), material.clone());
      particle.position.copy(center);
      particle.userData = {
        velocity: new THREE.Vector3(
          (Math.random() - 0.5) * 0.5,
          (Math.random() - 0.5) * 0.5,
          (Math.random() - 0.5) * 0.5
        )
      };
      scene.add(particle);
      particles.push(particle);
    }

    // ÙˆÙ…ÙŠØ¶ Ø¶ÙˆØ¦ÙŠ Ù„Ø­Ø¸Ø© Ø§Ù„Ø§Ù†ÙØ¬Ø§Ø±
    const flash = new THREE.PointLight(0x00ffff, 5, 50);
    flash.position.copy(center);
    scene.add(flash);
    setTimeout(() => scene.remove(flash), 300);

    scene.remove(obj); // Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø© ØªØ®ØªÙÙŠ
  }

  function showMessage(msg) {
    const box = document.getElementById("message-box");
    box.innerHTML = msg;
    box.classList.add("active");
    setTimeout(() => box.classList.remove("active"), 4000);
  }

  init();
</script>
